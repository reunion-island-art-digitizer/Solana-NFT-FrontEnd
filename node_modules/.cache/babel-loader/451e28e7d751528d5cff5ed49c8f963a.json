{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"C:/Users/piroi16/Documents/GitHub/Solana-NFT-FrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _slicedToArray = require(\"C:/Users/piroi16/Documents/GitHub/Solana-NFT-FrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useWalletInternal = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar fast_json_stable_stringify_1 = (0, tslib_1.__importDefault)(require(\"fast-json-stable-stringify\"));\n\nvar react_1 = require(\"react\");\n\nvar error_1 = require(\"../error\");\n\nvar providers_1 = require(\"../providers\");\n\nvar useLocalStorageState_1 = require(\"./useLocalStorageState\");\n\nvar useWalletInternal = function useWalletInternal(_ref) {\n  var onConnect = _ref.onConnect,\n      onDisconnect = _ref.onDisconnect,\n      network = _ref.network,\n      endpoint = _ref.endpoint,\n      onError = _ref.onError;\n\n  var _a;\n\n  var _ref2 = (0, useLocalStorageState_1.useLocalStorageState)(\"use-solana/wallet-config\", null),\n      _ref3 = _slicedToArray(_ref2, 2),\n      walletConfigStr = _ref3[0],\n      setWalletConfigStr = _ref3[1];\n\n  var walletConfig = (0, react_1.useMemo)(function () {\n    try {\n      return walletConfigStr ? JSON.parse(walletConfigStr) : null;\n    } catch (e) {\n      console.warn(\"Error parsing wallet config\", e);\n      return null;\n    }\n  }, [walletConfigStr]);\n\n  var _ref4 = walletConfig !== null && walletConfig !== void 0 ? walletConfig : {\n    walletType: null,\n    walletArgs: null\n  },\n      walletType = _ref4.walletType,\n      walletArgs = _ref4.walletArgs;\n\n  var _ref5 = (0, react_1.useState)(false),\n      _ref6 = _slicedToArray(_ref5, 2),\n      connected = _ref6[0],\n      setConnected = _ref6[1];\n\n  var _ref7 = (0, react_1.useMemo)(function () {\n    if (walletType) {\n      var provider = providers_1.WALLET_PROVIDERS[walletType];\n      console.debug(\"New wallet\", provider.url, network);\n      return [provider, new provider.makeAdapter(provider.url, endpoint)];\n    }\n\n    return [undefined, undefined];\n  }, [walletType, network, endpoint]),\n      _ref8 = _slicedToArray(_ref7, 2),\n      walletProviderInfo = _ref8[0],\n      wallet = _ref8[1];\n\n  (0, react_1.useEffect)(function () {\n    if (wallet && walletProviderInfo) {\n      setTimeout(function () {\n        void wallet.connect(walletArgs).catch(function (e) {\n          onError(new error_1.WalletAutomaticConnectionError(e, walletProviderInfo));\n        });\n      }, 500);\n      wallet.on(\"connect\", function () {\n        if (wallet === null || wallet === void 0 ? void 0 : wallet.publicKey) {\n          setConnected(true);\n          onConnect(wallet, walletProviderInfo);\n        }\n      });\n      wallet.on(\"disconnect\", function () {\n        setConnected(false);\n        onDisconnect(wallet, walletProviderInfo);\n      });\n    }\n\n    return function () {\n      if (wallet && wallet.connected) {\n        var _disconnect = wallet.disconnect();\n\n        if (_disconnect) {\n          _disconnect.catch(function (e) {\n            onError(new error_1.WalletDisconnectError(e, walletProviderInfo));\n          });\n        }\n      }\n    };\n  }, [onConnect, onDisconnect, onError, wallet, walletArgs, walletProviderInfo]);\n  var activate = (0, react_1.useCallback)(function (nextWalletType, nextWalletArgs) {\n    return (0, tslib_1.__awaiter)(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var nextWalletConfigStr;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              nextWalletConfigStr = (0, fast_json_stable_stringify_1.default)({\n                walletType: nextWalletType,\n                walletArgs: nextWalletArgs !== null && nextWalletArgs !== void 0 ? nextWalletArgs : null\n              });\n\n              if (!(walletConfigStr === nextWalletConfigStr)) {\n                _context.next = 10;\n                break;\n              }\n\n              _context.prev = 2;\n              _context.next = 5;\n              return wallet === null || wallet === void 0 ? void 0 : wallet.connect(nextWalletArgs);\n\n            case 5:\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](2);\n              onError(new error_1.WalletActivateError(_context.t0, nextWalletType, nextWalletArgs));\n\n            case 10:\n              setWalletConfigStr(nextWalletConfigStr);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 7]]);\n    }));\n  }, [onError, setWalletConfigStr, wallet, walletConfigStr]);\n  var disconnect = (0, react_1.useCallback)(function () {\n    wallet === null || wallet === void 0 ? void 0 : wallet.disconnect();\n    setWalletConfigStr(null);\n  }, [setWalletConfigStr, wallet]);\n  return {\n    wallet: wallet,\n    walletProviderInfo: walletProviderInfo,\n    connected: connected,\n    publicKey: (_a = wallet === null || wallet === void 0 ? void 0 : wallet.publicKey) !== null && _a !== void 0 ? _a : undefined,\n    activate: activate,\n    disconnect: disconnect\n  };\n};\n\nexports.useWalletInternal = useWalletInternal;","map":{"version":3,"sources":["../../src/utils/useWalletInternal.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAEA,IAAA,4BAAA,GAAA,CAAA,GAAA,OAAA,CAAA,eAAA,EAAA,OAAA,CAAA,4BAAA,CAAA,CAAA;;AACA,IAAA,OAAA,GAAA,OAAA,CAAA,OAAA,CAAA;;AAIA,IAAA,OAAA,GAAA,OAAA,CAAA,UAAA,CAAA;;AAMA,IAAA,WAAA,GAAA,OAAA,CAAA,cAAA,CAAA;;AACA,IAAA,sBAAA,GAAA,OAAA,CAAA,wBAAA,CAAA;;AAsDO,IAAM,iBAAiB,GAAG,SAApB,iBAAoB,OAMO;AAAA,MALtC,SAKsC,QALtC,SAKsC;AAAA,MAJtC,YAIsC,QAJtC,YAIsC;AAAA,MAHtC,OAGsC,QAHtC,OAGsC;AAAA,MAFtC,QAEsC,QAFtC,QAEsC;AAAA,MADtC,OACsC,QADtC,OACsC;;;;AACtC,cAA8C,CAAA,GAAA,sBAAA,CAAA,oBAAA,EAE5C,0BAF4C,EAEhB,IAFgB,CAA9C;AAAA;AAAA,MAAO,eAAP;AAAA,MAAwB,kBAAxB;;AAIA,MAAM,YAAY,GAAwB,CAAA,GAAA,OAAA,CAAA,OAAA,EAAQ,YAAK;AACrD,QAAI;AACF,aAAO,eAAe,GACjB,IAAI,CAAC,KAAL,CAAW,eAAX,CADiB,GAElB,IAFJ;AAGD,KAJD,CAIE,OAAO,CAAP,EAAU;AACV,MAAA,OAAO,CAAC,IAAR,CAAa,6BAAb,EAA4C,CAA5C;AACA,aAAO,IAAP;AACD;AACF,GATyC,EASvC,CAAC,eAAD,CATuC,CAA1C;;AAUA,cAAmC,YAAY,KAAA,IAAZ,IAAA,YAAY,KAAA,KAAA,CAAZ,GAAA,YAAA,GAAgB;AACjD,IAAA,UAAU,EAAE,IADqC;AAEjD,IAAA,UAAU,EAAE;AAFqC,GAAnD;AAAA,MAAQ,UAAR,SAAQ,UAAR;AAAA,MAAoB,UAApB,SAAoB,UAApB;;AAKA,cAAkC,CAAA,GAAA,OAAA,CAAA,QAAA,EAAS,KAAT,CAAlC;AAAA;AAAA,MAAO,SAAP;AAAA,MAAkB,YAAlB;;AAEA,cAEsC,CAAA,GAAA,OAAA,CAAA,OAAA,EAAQ,YAAK;AACjD,QAAI,UAAJ,EAAgB;AACd,UAAM,QAAQ,GAAG,WAAA,CAAA,gBAAA,CAAiB,UAAjB,CAAjB;AACA,MAAA,OAAO,CAAC,KAAR,CAAc,YAAd,EAA4B,QAAQ,CAAC,GAArC,EAA0C,OAA1C;AACA,aAAO,CAAC,QAAD,EAAW,IAAI,QAAQ,CAAC,WAAb,CAAyB,QAAQ,CAAC,GAAlC,EAAuC,QAAvC,CAAX,CAAP;AACD;;AACD,WAAO,CAAC,SAAD,EAAY,SAAZ,CAAP;AACD,GAPqC,EAOnC,CAAC,UAAD,EAAa,OAAb,EAAsB,QAAtB,CAPmC,CAFtC;AAAA;AAAA,MAAO,kBAAP;AAAA,MAA2B,MAA3B;;AAWA,GAAA,GAAA,OAAA,CAAA,SAAA,EAAU,YAAK;AACb,QAAI,MAAM,IAAI,kBAAd,EAAkC;AAChC,MAAA,UAAU,CAAC,YAAK;AACd,aAAK,MAAM,CAAC,OAAP,CAAe,UAAf,EAA2B,KAA3B,CAAiC,UAAC,CAAD,EAAM;AAC1C,UAAA,OAAO,CAAC,IAAI,OAAA,CAAA,8BAAJ,CAAmC,CAAnC,EAAsC,kBAAtC,CAAD,CAAP;AACD,SAFI,CAAL;AAGD,OAJS,EAIP,GAJO,CAAV;AAKA,MAAA,MAAM,CAAC,EAAP,CAAU,SAAV,EAAqB,YAAK;AACxB,YAAI,MAAM,KAAA,IAAN,IAAA,MAAM,KAAA,KAAA,CAAN,GAAM,KAAA,CAAN,GAAA,MAAM,CAAE,SAAZ,EAAuB;AACrB,UAAA,YAAY,CAAC,IAAD,CAAZ;AACA,UAAA,SAAS,CAAC,MAAD,EAA4B,kBAA5B,CAAT;AACD;AACF,OALD;AAOA,MAAA,MAAM,CAAC,EAAP,CAAU,YAAV,EAAwB,YAAK;AAC3B,QAAA,YAAY,CAAC,KAAD,CAAZ;AACA,QAAA,YAAY,CAAC,MAAD,EAAiC,kBAAjC,CAAZ;AACD,OAHD;AAID;;AAED,WAAO,YAAK;AACV,UAAI,MAAM,IAAI,MAAM,CAAC,SAArB,EAAgC;AAC9B,YAAM,WAAU,GAAG,MAAM,CAAC,UAAP,EAAnB;;AACA,YAAI,WAAJ,EAAgB;AACd,UAAA,WAAU,CAAC,KAAX,CAAiB,UAAC,CAAD,EAAM;AACrB,YAAA,OAAO,CAAC,IAAI,OAAA,CAAA,qBAAJ,CAA0B,CAA1B,EAA6B,kBAA7B,CAAD,CAAP;AACD,WAFD;AAGD;AACF;AACF,KATD;AAUD,GA9BD,EA8BG,CACD,SADC,EAED,YAFC,EAGD,OAHC,EAID,MAJC,EAKD,UALC,EAMD,kBANC,CA9BH;AAuCA,MAAM,QAAQ,GAAG,CAAA,GAAA,OAAA,CAAA,WAAA,EACf,UACE,cADF,EAEE,cAFF;AAAA,WAGmB,CAAA,GAAA,OAAA,CAAA,SAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,wCAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACX,cAAA,mBADW,GACW,CAAA,GAAA,4BAAA,CAAA,OAAA,EAAU;AACpC,gBAAA,UAAU,EAAE,cADwB;AAEpC,gBAAA,UAAU,EAAE,cAAc,KAAA,IAAd,IAAA,cAAc,KAAA,KAAA,CAAd,GAAA,cAAA,GAAkB;AAFM,eAAV,CADX;;AAAA,oBAKb,eAAe,KAAK,mBALP;AAAA;AAAA;AAAA;;AAAA;AAAA;AAQb,qBAAM,MAAM,KAAA,IAAN,IAAA,MAAM,KAAA,KAAA,CAAN,GAAM,KAAA,CAAN,GAAA,MAAM,CAAE,OAAR,CAAgB,cAAhB,CAAN;;AARa;AAAA;AAAA;;AAAA;AAAA;AAAA;AAUb,cAAA,OAAO,CAAC,IAAI,OAAA,CAAA,mBAAJ,cAA2B,cAA3B,EAA2C,cAA3C,CAAD,CAAP;;AAVa;AAajB,cAAA,kBAAkB,CAAC,mBAAD,CAAlB;;AAbiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAA,EAHnB;AAAA,GADe,EAmBf,CAAC,OAAD,EAAU,kBAAV,EAA8B,MAA9B,EAAsC,eAAtC,CAnBe,CAAjB;AAsBA,MAAM,UAAU,GAAG,CAAA,GAAA,OAAA,CAAA,WAAA,EAAY,YAAK;AAClC,IAAA,MAAM,KAAA,IAAN,IAAA,MAAM,KAAA,KAAA,CAAN,GAAM,KAAA,CAAN,GAAA,MAAM,CAAE,UAAR,EAAA;AACA,IAAA,kBAAkB,CAAC,IAAD,CAAlB;AACD,GAHkB,EAGhB,CAAC,kBAAD,EAAqB,MAArB,CAHgB,CAAnB;AAKA,SAAO;AACL,IAAA,MAAM,EAAN,MADK;AAEL,IAAA,kBAAkB,EAAlB,kBAFK;AAGL,IAAA,SAAS,EAAT,SAHK;AAIL,IAAA,SAAS,EAAE,CAAA,EAAA,GAAA,MAAM,KAAA,IAAN,IAAA,MAAM,KAAA,KAAA,CAAN,GAAM,KAAA,CAAN,GAAA,MAAM,CAAE,SAAR,MAAiB,IAAjB,IAAiB,EAAA,KAAA,KAAA,CAAjB,GAAiB,EAAjB,GAAqB,SAJ3B;AAKL,IAAA,QAAQ,EAAR,QALK;AAML,IAAA,UAAU,EAAV;AANK,GAAP;AAQD,CAjHM;;AAAM,OAAA,CAAA,iBAAA,GAAiB,iBAAjB","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useWalletInternal = void 0;\nconst tslib_1 = require(\"tslib\");\nconst fast_json_stable_stringify_1 = (0, tslib_1.__importDefault)(require(\"fast-json-stable-stringify\"));\nconst react_1 = require(\"react\");\nconst error_1 = require(\"../error\");\nconst providers_1 = require(\"../providers\");\nconst useLocalStorageState_1 = require(\"./useLocalStorageState\");\nconst useWalletInternal = ({ onConnect, onDisconnect, network, endpoint, onError, }) => {\n    var _a;\n    const [walletConfigStr, setWalletConfigStr] = (0, useLocalStorageState_1.useLocalStorageState)(\"use-solana/wallet-config\", null);\n    const walletConfig = (0, react_1.useMemo)(() => {\n        try {\n            return walletConfigStr\n                ? JSON.parse(walletConfigStr)\n                : null;\n        }\n        catch (e) {\n            console.warn(\"Error parsing wallet config\", e);\n            return null;\n        }\n    }, [walletConfigStr]);\n    const { walletType, walletArgs } = walletConfig !== null && walletConfig !== void 0 ? walletConfig : {\n        walletType: null,\n        walletArgs: null,\n    };\n    const [connected, setConnected] = (0, react_1.useState)(false);\n    const [walletProviderInfo, wallet] = (0, react_1.useMemo)(() => {\n        if (walletType) {\n            const provider = providers_1.WALLET_PROVIDERS[walletType];\n            console.debug(\"New wallet\", provider.url, network);\n            return [provider, new provider.makeAdapter(provider.url, endpoint)];\n        }\n        return [undefined, undefined];\n    }, [walletType, network, endpoint]);\n    (0, react_1.useEffect)(() => {\n        if (wallet && walletProviderInfo) {\n            setTimeout(() => {\n                void wallet.connect(walletArgs).catch((e) => {\n                    onError(new error_1.WalletAutomaticConnectionError(e, walletProviderInfo));\n                });\n            }, 500);\n            wallet.on(\"connect\", () => {\n                if (wallet === null || wallet === void 0 ? void 0 : wallet.publicKey) {\n                    setConnected(true);\n                    onConnect(wallet, walletProviderInfo);\n                }\n            });\n            wallet.on(\"disconnect\", () => {\n                setConnected(false);\n                onDisconnect(wallet, walletProviderInfo);\n            });\n        }\n        return () => {\n            if (wallet && wallet.connected) {\n                const disconnect = wallet.disconnect();\n                if (disconnect) {\n                    disconnect.catch((e) => {\n                        onError(new error_1.WalletDisconnectError(e, walletProviderInfo));\n                    });\n                }\n            }\n        };\n    }, [\n        onConnect,\n        onDisconnect,\n        onError,\n        wallet,\n        walletArgs,\n        walletProviderInfo,\n    ]);\n    const activate = (0, react_1.useCallback)((nextWalletType, nextWalletArgs) => (0, tslib_1.__awaiter)(void 0, void 0, void 0, function* () {\n        const nextWalletConfigStr = (0, fast_json_stable_stringify_1.default)({\n            walletType: nextWalletType,\n            walletArgs: nextWalletArgs !== null && nextWalletArgs !== void 0 ? nextWalletArgs : null,\n        });\n        if (walletConfigStr === nextWalletConfigStr) {\n            // reconnect\n            try {\n                yield (wallet === null || wallet === void 0 ? void 0 : wallet.connect(nextWalletArgs));\n            }\n            catch (e) {\n                onError(new error_1.WalletActivateError(e, nextWalletType, nextWalletArgs));\n            }\n        }\n        setWalletConfigStr(nextWalletConfigStr);\n    }), [onError, setWalletConfigStr, wallet, walletConfigStr]);\n    const disconnect = (0, react_1.useCallback)(() => {\n        wallet === null || wallet === void 0 ? void 0 : wallet.disconnect();\n        setWalletConfigStr(null);\n    }, [setWalletConfigStr, wallet]);\n    return {\n        wallet,\n        walletProviderInfo,\n        connected,\n        publicKey: (_a = wallet === null || wallet === void 0 ? void 0 : wallet.publicKey) !== null && _a !== void 0 ? _a : undefined,\n        activate,\n        disconnect,\n    };\n};\nexports.useWalletInternal = useWalletInternal;\n//# sourceMappingURL=useWalletInternal.js.map"]},"metadata":{},"sourceType":"script"}